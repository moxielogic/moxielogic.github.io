<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="./theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="./theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="./theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Anthony Green">
  <meta name="description" content="Posts and writings by Anthony Green">


<meta name="keywords" content="architecture, muskoka, SoC, verilog, wishbone">

  <title>
    The Moxie Blog
&ndash; A simulation milestone for the Muskoka SoC!  </title>

</head>

<body>
  <aside>
    <div id="user_meta">
      <a href=".">
        <img src="http://moxielogic.github.io/images/ml.png" alt="logo">
      </a>
      <h2><a href=".">The Moxie Blog</a></h2>
      <p>A development blog for the <b>moxie processor</b>, an open source embedded soft-core processor.</p>
      <ul>
        <li><a href="./pages/about.html">About</a></li>
        <li><a href="./pages/author.html">Author</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>
      <a href=".">Index</a> &brvbar; <a href="./archives.html">Archives</a>
      </p>
    </header>

<article>
  <div class="article_title">
    <h3><a href="./a-simulation-milestone-for-the-muskoka-soc.html">A simulation milestone for the Muskoka SoC!</a></h3>
  </div>
  <div class="article_text">
    <p>A moxie-based SoC had it's first successful simulation run today....</p>
<p><center>
<img alt="gtkwave display of first code run" src="http://moxielogic.org/blog/wp-content/uploads/2011/09/gtkwave20110927-300x204.png" />
</center></p>
<p>Pretty exciting! So, here's what's happening...</p>
<p>The SoC, code named "Muskoka", has three main components: the moxie
core, a wishbone switch and a ROM device. The switch was easy to
implement, as I just have a single bus master (moxie), and a single
slave device (bootrom) for now. The boot ROM is populated with bits
generated by assembling the code below like so:</p>
<p><code>moxie-elf-as -o bootrom.x bootrom.s     moxie-elf-objcopy -O verilog bootrom.x bootrom.vh</code></p>
<div class="highlight"><pre><span class="na">.text</span>
    <span class="nf">xor</span> <span class="no">$r0</span><span class="p">,</span> <span class="no">$r0</span>  <span class="c"># Zero out $r0</span>
    <span class="nf">xor</span> <span class="no">$r1</span><span class="p">,</span> <span class="no">$r1</span>
    <span class="nf">xor</span> <span class="no">$r2</span><span class="p">,</span> <span class="no">$r2</span>
    <span class="nf">xor</span> <span class="no">$r3</span><span class="p">,</span> <span class="no">$r3</span>
    <span class="nf">xor</span> <span class="no">$r4</span><span class="p">,</span> <span class="no">$r4</span>
    <span class="nf">inc</span> <span class="no">$r0</span><span class="p">,</span> <span class="mi">0x1</span>  <span class="c"># Increment $r0 by 1</span>
    <span class="nf">inc</span> <span class="no">$r1</span><span class="p">,</span> <span class="mi">0x1</span>
    <span class="nf">inc</span> <span class="no">$r2</span><span class="p">,</span> <span class="mi">0x1</span>
    <span class="nf">inc</span> <span class="no">$r3</span><span class="p">,</span> <span class="mi">0x1</span>
    <span class="nf">inc</span> <span class="no">$r4</span><span class="p">,</span> <span class="mi">0x1</span>
    <span class="nf">inc</span> <span class="no">$r0</span><span class="p">,</span> <span class="mi">0x1</span>
    <span class="nf">inc</span> <span class="no">$r1</span><span class="p">,</span> <span class="mi">0x1</span>
    <span class="nf">inc</span> <span class="no">$r2</span><span class="p">,</span> <span class="mi">0x1</span>
    <span class="nf">inc</span> <span class="no">$r3</span><span class="p">,</span> <span class="mi">0x1</span>
    <span class="nf">inc</span> <span class="no">$r4</span><span class="p">,</span> <span class="mi">0x1</span>
    <span class="nf">inc</span> <span class="no">$r0</span><span class="p">,</span> <span class="mi">0x1</span>
    <span class="nf">inc</span> <span class="no">$r1</span><span class="p">,</span> <span class="mi">0x1</span>
    <span class="nf">inc</span> <span class="no">$r2</span><span class="p">,</span> <span class="mi">0x1</span>
    <span class="nf">inc</span> <span class="no">$r3</span><span class="p">,</span> <span class="mi">0x1</span>
    <span class="nf">inc</span> <span class="no">$r4</span><span class="p">,</span> <span class="mi">0x1</span>
</pre></div>


<p>The moxie core itself is has 4 pipeline stages: Fetch, Decode, Execute
and Write. The Fetch stage is probably the most complicated at this
point. Remember that moxie has both 16- and 48-bit instructions.
However, we're fetching instruction memory from the ROM device 32-bits
at a time. The fetch logic feeds these 32-bits into an instruction queue
and pulls out the right number of bits at the other end, depending on
the instruction about to be decoded.</p>
<p>So far only NOP, XOR and INC have been implemented, and there's no
pipeline hazard detection logic, but careful analysis of the simulation
dumps in gtkwave show that everything is finally starting to work. Baby
steps...</p>
<p>As usual, everything has been committed to <a href="http://github.com/atgreen/moxiedev" title="moxiedev">moxiedev</a> on github.</p>
  </div>
  <div class="article_meta">
    <p>Posted on: Tue 27 September 2011</p>
    <p>Category: <a href="./category/moxie.html">moxie</a>
 &ndash; Tags:
      <a href="./tag/architecture.html">architecture</a>,      <a href="./tag/muskoka.html">muskoka</a>,      <a href="./tag/soc.html">SoC</a>,      <a href="./tag/verilog.html">verilog</a>,      <a href="./tag/wishbone.html">wishbone</a>    </p>
  </div>


</article>


    <div id="ending_message">
      <p>&copy; Anthony Green. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. .</p>
    </div>
  </main>
</body>
</html>